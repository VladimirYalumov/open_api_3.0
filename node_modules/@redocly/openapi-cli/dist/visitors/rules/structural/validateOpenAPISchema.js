"use strict";

var _utils = require("../../../utils");

class ValidateOpenAPISchema {
  static get rule() {
    return 'oas3-schema/schema';
  }

  get validators() {
    return {
      title(node, ctx) {
        if (node && node.title) {
          if (!(typeof node.title === 'string')) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      multipleOf(node, ctx) {
        if (node && node.multipleOf) {
          if (typeof node.multipleOf !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.multipleOf < 0) return ctx.createError('Value of multipleOf must be greater or equal to zero', 'value');
        }

        return null;
      },

      maximum(node, ctx) {
        if (node && node.maximum && typeof node.maximum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMaximum(node, ctx) {
        if (node && node.exclusiveMaximum && typeof node.exclusiveMaximum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      minimum(node, ctx) {
        if (node && node.minimum && typeof node.minimum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMinimum(node, ctx) {
        if (node && node.exclusiveMinimum && typeof node.exclusiveMinimum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      maxLength(node, ctx) {
        if (node && node.maxLength) {
          if (typeof node.maxLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxLength < 0) return ctx.createError('Value of maxLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      minLength(node, ctx) {
        if (node && node.minLength) {
          if (typeof node.minLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minLength < 0) return ctx.createError('Value of minLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      pattern(node, ctx) {
        if (node && node.pattern) {
          // TODO: add regexp validation.
          if (typeof node.pattern !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      maxItems(node, ctx) {
        if (node && node.maxItems) {
          if (typeof node.maxItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxItems < 0) return ctx.createError('Value of maxItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minItems(node, ctx) {
        if (node && node.minItems) {
          if (typeof node.minItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minItems < 0) return ctx.createError('Value of minItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      uniqueItems(node, ctx) {
        if (node && node.uniqueItems) {
          if (typeof node.uniqueItems !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        }

        return null;
      },

      maxProperties(node, ctx) {
        if (node && node.maxProperties) {
          if (typeof node.maxProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxProperties < 0) return ctx.createError('Value of maxProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minProperties(node, ctx) {
        if (node && node.minProperties) {
          if (typeof node.minProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minProperties < 0) return ctx.createError('Value of minProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      required(node, ctx) {
        if (node && node.required) {
          if (!Array.isArray(node.required)) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value');
          if (node.required.filter(item => typeof item !== 'string').length !== 0) return ctx.createError('All values of "required" field must be strings', 'value');
        }

        return null;
      },

      enum(node, ctx) {
        const errors = [];

        if (node && node.enum) {
          if (!Array.isArray(node.enum)) return [ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value')];

          if (node.type && typeof node.type === 'string') {
            const typeMimsatch = node.enum.filter(item => !(0, _utils.matchesJsonSchemaType)(item, node.type));
            typeMimsatch.forEach(val => {
              ctx.path.push(node.enum.indexOf(val));
              errors.push(ctx.createError('All values of "enum" field must be of the same type as the "type" field.', 'value'));
              ctx.path.pop();
            });
          }
        }

        return errors;
      },

      type(node, ctx) {
        const errors = [];
        if (node.type && node.type && typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (node.type && !['string', 'object', 'array', 'integer', 'number', 'boolean'].includes(node.type)) {
          const possibleAlternate = (0, _utils.getClosestString)(node.type, ['string', 'object', 'array', 'integer', 'number', 'boolean']);
          errors.push(ctx.createError('Object type can be one of following only: "string", "object", "array", "integer", "number", "boolean".', 'value', {
            possibleAlternate
          }));
        }

        return errors;
      },

      items(node, ctx) {
        if (node && node.items && Array.isArray(node.items)) return ctx.createError('Value of items must not be an array. It must be a Schema object', 'value');
        return null;
      },

      additionalProperties: () => null,

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      format(node, ctx) {
        if (node && node.format && typeof node.format !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      nullable(node, ctx) {
        if (node && node.nullable && typeof node.nullable !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      readOnly(node, ctx) {
        if (node && node.readOnly && typeof node.readOnly !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      writeOnly(node, ctx) {
        if (node && node.writeOnly && typeof node.writeOnly !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      deprecated(node, ctx) {
        if (node && node.deprecated && typeof node.deprecated !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      }

    };
  }

  OpenAPISchema() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOpenAPISchema;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9zdHJ1Y3R1cmFsL3ZhbGlkYXRlT3BlbkFQSVNjaGVtYS5qcyJdLCJuYW1lcyI6WyJWYWxpZGF0ZU9wZW5BUElTY2hlbWEiLCJydWxlIiwidmFsaWRhdG9ycyIsInRpdGxlIiwibm9kZSIsImN0eCIsImNyZWF0ZUVycm9yIiwibWVzc2FnZUhlbHBlcnMiLCJmaWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIiLCJtdWx0aXBsZU9mIiwibWF4aW11bSIsImV4Y2x1c2l2ZU1heGltdW0iLCJtaW5pbXVtIiwiZXhjbHVzaXZlTWluaW11bSIsIm1heExlbmd0aCIsIm1pbkxlbmd0aCIsInBhdHRlcm4iLCJtYXhJdGVtcyIsIm1pbkl0ZW1zIiwidW5pcXVlSXRlbXMiLCJtYXhQcm9wZXJ0aWVzIiwibWluUHJvcGVydGllcyIsInJlcXVpcmVkIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiaXRlbSIsImxlbmd0aCIsImVudW0iLCJlcnJvcnMiLCJ0eXBlIiwidHlwZU1pbXNhdGNoIiwiZm9yRWFjaCIsInZhbCIsInBhdGgiLCJwdXNoIiwiaW5kZXhPZiIsInBvcCIsImluY2x1ZGVzIiwicG9zc2libGVBbHRlcm5hdGUiLCJpdGVtcyIsImFkZGl0aW9uYWxQcm9wZXJ0aWVzIiwiZGVzY3JpcHRpb24iLCJmb3JtYXQiLCJudWxsYWJsZSIsInJlYWRPbmx5Iiwid3JpdGVPbmx5IiwiZGVwcmVjYXRlZCIsIk9wZW5BUElTY2hlbWEiLCJvbkVudGVyIiwiZGVmaW5pdGlvbiIsInZhbGlkYXRlRmllbGRzIiwiY29uZmlnIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFHQSxNQUFNQSxxQkFBTixDQUE0QjtBQUMxQixhQUFXQyxJQUFYLEdBQWtCO0FBQ2hCLFdBQU8sb0JBQVA7QUFDRDs7QUFFRCxNQUFJQyxVQUFKLEdBQWlCO0FBQ2YsV0FBTztBQUNMQyxNQUFBQSxLQUFLLENBQUNDLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ2YsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNELEtBQWpCLEVBQXdCO0FBQ3RCLGNBQUksRUFBRSxPQUFPQyxJQUFJLENBQUNELEtBQVosS0FBc0IsUUFBeEIsQ0FBSixFQUF1QyxPQUFPRSxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDeEM7O0FBQ0QsZUFBTyxJQUFQO0FBQ0QsT0FOSTs7QUFPTEMsTUFBQUEsVUFBVSxDQUFDTCxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNwQixZQUFJRCxJQUFJLElBQUlBLElBQUksQ0FBQ0ssVUFBakIsRUFBNkI7QUFDM0IsY0FBSSxPQUFPTCxJQUFJLENBQUNLLFVBQVosS0FBMkIsUUFBL0IsRUFBeUMsT0FBT0osR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJDLDhCQUFuQixDQUFrRCxRQUFsRCxDQUFoQixFQUE2RSxPQUE3RSxDQUFQO0FBQ3pDLGNBQUlKLElBQUksQ0FBQ0ssVUFBTCxHQUFrQixDQUF0QixFQUF5QixPQUFPSixHQUFHLENBQUNDLFdBQUosQ0FBZ0Isc0RBQWhCLEVBQXdFLE9BQXhFLENBQVA7QUFDMUI7O0FBQ0QsZUFBTyxJQUFQO0FBQ0QsT0FiSTs7QUFjTEksTUFBQUEsT0FBTyxDQUFDTixJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNqQixZQUFJRCxJQUFJLElBQUlBLElBQUksQ0FBQ00sT0FBYixJQUF3QixPQUFPTixJQUFJLENBQUNNLE9BQVosS0FBd0IsUUFBcEQsRUFBOEQsT0FBT0wsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJDLDhCQUFuQixDQUFrRCxRQUFsRCxDQUFoQixFQUE2RSxPQUE3RSxDQUFQO0FBQzlELGVBQU8sSUFBUDtBQUNELE9BakJJOztBQWtCTEcsTUFBQUEsZ0JBQWdCLENBQUNQLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQzFCLFlBQUlELElBQUksSUFBSUEsSUFBSSxDQUFDTyxnQkFBYixJQUFpQyxPQUFPUCxJQUFJLENBQUNPLGdCQUFaLEtBQWlDLFNBQXRFLEVBQWlGLE9BQU9OLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyw4QkFBbkIsQ0FBa0QsU0FBbEQsQ0FBaEIsRUFBOEUsT0FBOUUsQ0FBUDtBQUNqRixlQUFPLElBQVA7QUFDRCxPQXJCSTs7QUFzQkxJLE1BQUFBLE9BQU8sQ0FBQ1IsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDakIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNRLE9BQWIsSUFBd0IsT0FBT1IsSUFBSSxDQUFDUSxPQUFaLEtBQXdCLFFBQXBELEVBQThELE9BQU9QLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyw4QkFBbkIsQ0FBa0QsUUFBbEQsQ0FBaEIsRUFBNkUsT0FBN0UsQ0FBUDtBQUM5RCxlQUFPLElBQVA7QUFDRCxPQXpCSTs7QUEwQkxLLE1BQUFBLGdCQUFnQixDQUFDVCxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUMxQixZQUFJRCxJQUFJLElBQUlBLElBQUksQ0FBQ1MsZ0JBQWIsSUFBaUMsT0FBT1QsSUFBSSxDQUFDUyxnQkFBWixLQUFpQyxTQUF0RSxFQUFpRixPQUFPUixHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFNBQWxELENBQWhCLEVBQThFLE9BQTlFLENBQVA7QUFDakYsZUFBTyxJQUFQO0FBQ0QsT0E3Qkk7O0FBOEJMTSxNQUFBQSxTQUFTLENBQUNWLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ25CLFlBQUlELElBQUksSUFBSUEsSUFBSSxDQUFDVSxTQUFqQixFQUE0QjtBQUMxQixjQUFJLE9BQU9WLElBQUksQ0FBQ1UsU0FBWixLQUEwQixRQUE5QixFQUF3QyxPQUFPVCxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDeEMsY0FBSUosSUFBSSxDQUFDVSxTQUFMLEdBQWlCLENBQXJCLEVBQXdCLE9BQU9ULEdBQUcsQ0FBQ0MsV0FBSixDQUFnQixzREFBaEIsRUFBd0UsT0FBeEUsQ0FBUDtBQUN6Qjs7QUFDRCxlQUFPLElBQVA7QUFDRCxPQXBDSTs7QUFxQ0xTLE1BQUFBLFNBQVMsQ0FBQ1gsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDbkIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNXLFNBQWpCLEVBQTRCO0FBQzFCLGNBQUksT0FBT1gsSUFBSSxDQUFDVyxTQUFaLEtBQTBCLFFBQTlCLEVBQXdDLE9BQU9WLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyw4QkFBbkIsQ0FBa0QsUUFBbEQsQ0FBaEIsRUFBNkUsT0FBN0UsQ0FBUDtBQUN4QyxjQUFJSixJQUFJLENBQUNXLFNBQUwsR0FBaUIsQ0FBckIsRUFBd0IsT0FBT1YsR0FBRyxDQUFDQyxXQUFKLENBQWdCLHNEQUFoQixFQUF3RSxPQUF4RSxDQUFQO0FBQ3pCOztBQUNELGVBQU8sSUFBUDtBQUNELE9BM0NJOztBQTRDTFUsTUFBQUEsT0FBTyxDQUFDWixJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNqQixZQUFJRCxJQUFJLElBQUlBLElBQUksQ0FBQ1ksT0FBakIsRUFBMEI7QUFDeEI7QUFDQSxjQUFJLE9BQU9aLElBQUksQ0FBQ1ksT0FBWixLQUF3QixRQUE1QixFQUFzQyxPQUFPWCxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDdkM7O0FBQ0QsZUFBTyxJQUFQO0FBQ0QsT0FsREk7O0FBbURMUyxNQUFBQSxRQUFRLENBQUNiLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ2xCLFlBQUlELElBQUksSUFBSUEsSUFBSSxDQUFDYSxRQUFqQixFQUEyQjtBQUN6QixjQUFJLE9BQU9iLElBQUksQ0FBQ2EsUUFBWixLQUF5QixRQUE3QixFQUF1QyxPQUFPWixHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDdkMsY0FBSUosSUFBSSxDQUFDYSxRQUFMLEdBQWdCLENBQXBCLEVBQXVCLE9BQU9aLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQixrR0FBaEIsRUFBb0gsT0FBcEgsQ0FBUDtBQUN4Qjs7QUFDRCxlQUFPLElBQVA7QUFDRCxPQXpESTs7QUEwRExZLE1BQUFBLFFBQVEsQ0FBQ2QsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDbEIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNjLFFBQWpCLEVBQTJCO0FBQ3pCLGNBQUksT0FBT2QsSUFBSSxDQUFDYyxRQUFaLEtBQXlCLFFBQTdCLEVBQXVDLE9BQU9iLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyw4QkFBbkIsQ0FBa0QsUUFBbEQsQ0FBaEIsRUFBNkUsT0FBN0UsQ0FBUDtBQUN2QyxjQUFJSixJQUFJLENBQUNjLFFBQUwsR0FBZ0IsQ0FBcEIsRUFBdUIsT0FBT2IsR0FBRyxDQUFDQyxXQUFKLENBQWdCLGtHQUFoQixFQUFvSCxPQUFwSCxDQUFQO0FBQ3hCOztBQUNELGVBQU8sSUFBUDtBQUNELE9BaEVJOztBQWlFTGEsTUFBQUEsV0FBVyxDQUFDZixJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNyQixZQUFJRCxJQUFJLElBQUlBLElBQUksQ0FBQ2UsV0FBakIsRUFBOEI7QUFDNUIsY0FBSSxPQUFPZixJQUFJLENBQUNlLFdBQVosS0FBNEIsU0FBaEMsRUFBMkMsT0FBT2QsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJDLDhCQUFuQixDQUFrRCxTQUFsRCxDQUFoQixFQUE4RSxPQUE5RSxDQUFQO0FBQzVDOztBQUNELGVBQU8sSUFBUDtBQUNELE9BdEVJOztBQXVFTFksTUFBQUEsYUFBYSxDQUFDaEIsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDdkIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNnQixhQUFqQixFQUFnQztBQUM5QixjQUFJLE9BQU9oQixJQUFJLENBQUNnQixhQUFaLEtBQThCLFFBQWxDLEVBQTRDLE9BQU9mLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyw4QkFBbkIsQ0FBa0QsUUFBbEQsQ0FBaEIsRUFBNkUsT0FBN0UsQ0FBUDtBQUM1QyxjQUFJSixJQUFJLENBQUNnQixhQUFMLEdBQXFCLENBQXpCLEVBQTRCLE9BQU9mLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQix1R0FBaEIsRUFBeUgsT0FBekgsQ0FBUDtBQUM3Qjs7QUFDRCxlQUFPLElBQVA7QUFDRCxPQTdFSTs7QUE4RUxlLE1BQUFBLGFBQWEsQ0FBQ2pCLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ3ZCLFlBQUlELElBQUksSUFBSUEsSUFBSSxDQUFDaUIsYUFBakIsRUFBZ0M7QUFDOUIsY0FBSSxPQUFPakIsSUFBSSxDQUFDaUIsYUFBWixLQUE4QixRQUFsQyxFQUE0QyxPQUFPaEIsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJDLDhCQUFuQixDQUFrRCxRQUFsRCxDQUFoQixFQUE2RSxPQUE3RSxDQUFQO0FBQzVDLGNBQUlKLElBQUksQ0FBQ2lCLGFBQUwsR0FBcUIsQ0FBekIsRUFBNEIsT0FBT2hCLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQix1R0FBaEIsRUFBeUgsT0FBekgsQ0FBUDtBQUM3Qjs7QUFDRCxlQUFPLElBQVA7QUFDRCxPQXBGSTs7QUFxRkxnQixNQUFBQSxRQUFRLENBQUNsQixJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNsQixZQUFJRCxJQUFJLElBQUlBLElBQUksQ0FBQ2tCLFFBQWpCLEVBQTJCO0FBQ3pCLGNBQUksQ0FBQ0MsS0FBSyxDQUFDQyxPQUFOLENBQWNwQixJQUFJLENBQUNrQixRQUFuQixDQUFMLEVBQW1DLE9BQU9qQixHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELE9BQWxELENBQWhCLEVBQTRFLE9BQTVFLENBQVA7QUFDbkMsY0FBSUosSUFBSSxDQUFDa0IsUUFBTCxDQUFjRyxNQUFkLENBQXNCQyxJQUFELElBQVUsT0FBT0EsSUFBUCxLQUFnQixRQUEvQyxFQUF5REMsTUFBekQsS0FBb0UsQ0FBeEUsRUFBMkUsT0FBT3RCLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQixnREFBaEIsRUFBa0UsT0FBbEUsQ0FBUDtBQUM1RTs7QUFDRCxlQUFPLElBQVA7QUFDRCxPQTNGSTs7QUE0RkxzQixNQUFBQSxJQUFJLENBQUN4QixJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNkLGNBQU13QixNQUFNLEdBQUcsRUFBZjs7QUFFQSxZQUFJekIsSUFBSSxJQUFJQSxJQUFJLENBQUN3QixJQUFqQixFQUF1QjtBQUNyQixjQUFJLENBQUNMLEtBQUssQ0FBQ0MsT0FBTixDQUFjcEIsSUFBSSxDQUFDd0IsSUFBbkIsQ0FBTCxFQUErQixPQUFPLENBQUN2QixHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELE9BQWxELENBQWhCLEVBQTRFLE9BQTVFLENBQUQsQ0FBUDs7QUFDL0IsY0FBSUosSUFBSSxDQUFDMEIsSUFBTCxJQUFhLE9BQU8xQixJQUFJLENBQUMwQixJQUFaLEtBQXFCLFFBQXRDLEVBQWdEO0FBQzlDLGtCQUFNQyxZQUFZLEdBQUczQixJQUFJLENBQUN3QixJQUFMLENBQVVILE1BQVYsQ0FDbEJDLElBQUQsSUFBVSxDQUFDLGtDQUFzQkEsSUFBdEIsRUFBNEJ0QixJQUFJLENBQUMwQixJQUFqQyxDQURRLENBQXJCO0FBSUFDLFlBQUFBLFlBQVksQ0FBQ0MsT0FBYixDQUFzQkMsR0FBRCxJQUFTO0FBQzVCNUIsY0FBQUEsR0FBRyxDQUFDNkIsSUFBSixDQUFTQyxJQUFULENBQWMvQixJQUFJLENBQUN3QixJQUFMLENBQVVRLE9BQVYsQ0FBa0JILEdBQWxCLENBQWQ7QUFDQUosY0FBQUEsTUFBTSxDQUFDTSxJQUFQLENBQVk5QixHQUFHLENBQUNDLFdBQUosQ0FBZ0IsMEVBQWhCLEVBQTRGLE9BQTVGLENBQVo7QUFDQUQsY0FBQUEsR0FBRyxDQUFDNkIsSUFBSixDQUFTRyxHQUFUO0FBQ0QsYUFKRDtBQUtEO0FBQ0Y7O0FBQ0QsZUFBT1IsTUFBUDtBQUNELE9BOUdJOztBQStHTEMsTUFBQUEsSUFBSSxDQUFDMUIsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDZCxjQUFNd0IsTUFBTSxHQUFHLEVBQWY7QUFDQSxZQUFJekIsSUFBSSxDQUFDMEIsSUFBTCxJQUFhMUIsSUFBSSxDQUFDMEIsSUFBbEIsSUFBMEIsT0FBTzFCLElBQUksQ0FBQzBCLElBQVosS0FBcUIsUUFBbkQsRUFBNkQsT0FBT3pCLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyw4QkFBbkIsQ0FBa0QsUUFBbEQsQ0FBaEIsRUFBNkUsT0FBN0UsQ0FBUDs7QUFDN0QsWUFBSUosSUFBSSxDQUFDMEIsSUFBTCxJQUFhLENBQUMsQ0FBQyxRQUFELEVBQVcsUUFBWCxFQUFxQixPQUFyQixFQUE4QixTQUE5QixFQUF5QyxRQUF6QyxFQUFtRCxTQUFuRCxFQUE4RFEsUUFBOUQsQ0FBdUVsQyxJQUFJLENBQUMwQixJQUE1RSxDQUFsQixFQUFxRztBQUNuRyxnQkFBTVMsaUJBQWlCLEdBQUcsNkJBQWlCbkMsSUFBSSxDQUFDMEIsSUFBdEIsRUFBNEIsQ0FBQyxRQUFELEVBQVcsUUFBWCxFQUFxQixPQUFyQixFQUE4QixTQUE5QixFQUF5QyxRQUF6QyxFQUFtRCxTQUFuRCxDQUE1QixDQUExQjtBQUNBRCxVQUFBQSxNQUFNLENBQUNNLElBQVAsQ0FBWTlCLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQix3R0FBaEIsRUFBMEgsT0FBMUgsRUFBbUk7QUFBRWlDLFlBQUFBO0FBQUYsV0FBbkksQ0FBWjtBQUNEOztBQUNELGVBQU9WLE1BQVA7QUFDRCxPQXZISTs7QUF3SExXLE1BQUFBLEtBQUssQ0FBQ3BDLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ2YsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNvQyxLQUFiLElBQXNCakIsS0FBSyxDQUFDQyxPQUFOLENBQWNwQixJQUFJLENBQUNvQyxLQUFuQixDQUExQixFQUFxRCxPQUFPbkMsR0FBRyxDQUFDQyxXQUFKLENBQWdCLGlFQUFoQixFQUFtRixPQUFuRixDQUFQO0FBQ3JELGVBQU8sSUFBUDtBQUNELE9BM0hJOztBQTRITG1DLE1BQUFBLG9CQUFvQixFQUFFLE1BQU0sSUE1SHZCOztBQTZITEMsTUFBQUEsV0FBVyxDQUFDdEMsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDckIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNzQyxXQUFiLElBQTRCLE9BQU90QyxJQUFJLENBQUNzQyxXQUFaLEtBQTRCLFFBQTVELEVBQXNFLE9BQU9yQyxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDdEUsZUFBTyxJQUFQO0FBQ0QsT0FoSUk7O0FBaUlMbUMsTUFBQUEsTUFBTSxDQUFDdkMsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDaEIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUN1QyxNQUFiLElBQXVCLE9BQU92QyxJQUFJLENBQUN1QyxNQUFaLEtBQXVCLFFBQWxELEVBQTRELE9BQU90QyxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDNUQsZUFBTyxJQUFQO0FBQ0QsT0FwSUk7O0FBcUlMb0MsTUFBQUEsUUFBUSxDQUFDeEMsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDbEIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUN3QyxRQUFiLElBQXlCLE9BQU94QyxJQUFJLENBQUN3QyxRQUFaLEtBQXlCLFNBQXRELEVBQWlFLE9BQU92QyxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFNBQWxELENBQWhCLEVBQThFLE9BQTlFLENBQVA7QUFDakUsZUFBTyxJQUFQO0FBQ0QsT0F4SUk7O0FBeUlMcUMsTUFBQUEsUUFBUSxDQUFDekMsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDbEIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUN5QyxRQUFiLElBQXlCLE9BQU96QyxJQUFJLENBQUN5QyxRQUFaLEtBQXlCLFNBQXRELEVBQWlFLE9BQU94QyxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFNBQWxELENBQWhCLEVBQThFLE9BQTlFLENBQVA7QUFDakUsZUFBTyxJQUFQO0FBQ0QsT0E1SUk7O0FBNklMc0MsTUFBQUEsU0FBUyxDQUFDMUMsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDbkIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUMwQyxTQUFiLElBQTBCLE9BQU8xQyxJQUFJLENBQUMwQyxTQUFaLEtBQTBCLFNBQXhELEVBQW1FLE9BQU96QyxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFNBQWxELENBQWhCLEVBQThFLE9BQTlFLENBQVA7QUFDbkUsZUFBTyxJQUFQO0FBQ0QsT0FoSkk7O0FBaUpMdUMsTUFBQUEsVUFBVSxDQUFDM0MsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDcEIsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUMyQyxVQUFiLElBQTJCLE9BQU8zQyxJQUFJLENBQUMyQyxVQUFaLEtBQTJCLFNBQTFELEVBQXFFLE9BQU8xQyxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsOEJBQW5CLENBQWtELFNBQWxELENBQWhCLEVBQThFLE9BQTlFLENBQVA7QUFDckUsZUFBTyxJQUFQO0FBQ0Q7O0FBcEpJLEtBQVA7QUFzSkQ7O0FBRUR3QyxFQUFBQSxhQUFhLEdBQUc7QUFDZCxXQUFPO0FBQ0xDLE1BQUFBLE9BQU8sRUFBRSxDQUFDN0MsSUFBRCxFQUFPOEMsVUFBUCxFQUFtQjdDLEdBQW5CLEtBQTJCQSxHQUFHLENBQUM4QyxjQUFKLENBQ2xDLEtBQUtDLE1BRDZCLEVBQ3JCLEtBQUtuRCxJQURnQixFQUNWLEtBQUtDLFVBREs7QUFEL0IsS0FBUDtBQUtEOztBQXBLeUI7O0FBdUs1Qm1ELE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnRELHFCQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hdGNoZXNKc29uU2NoZW1hVHlwZSwgZ2V0Q2xvc2VzdFN0cmluZyB9IGZyb20gJy4uLy4uLy4uL3V0aWxzJztcblxuXG5jbGFzcyBWYWxpZGF0ZU9wZW5BUElTY2hlbWEge1xuICBzdGF0aWMgZ2V0IHJ1bGUoKSB7XG4gICAgcmV0dXJuICdvYXMzLXNjaGVtYS9zY2hlbWEnO1xuICB9XG5cbiAgZ2V0IHZhbGlkYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnRpdGxlKSB7XG4gICAgICAgICAgaWYgKCEodHlwZW9mIG5vZGUudGl0bGUgPT09ICdzdHJpbmcnKSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbXVsdGlwbGVPZihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tdWx0aXBsZU9mKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm11bHRpcGxlT2YgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5tdWx0aXBsZU9mIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbXVsdGlwbGVPZiBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVybycsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heGltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5tYXhpbXVtICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGV4Y2x1c2l2ZU1heGltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZXhjbHVzaXZlTWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5leGNsdXNpdmVNYXhpbXVtICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluaW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5pbXVtICYmIHR5cGVvZiBub2RlLm1pbmltdW0gIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhjbHVzaXZlTWluaW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5leGNsdXNpdmVNaW5pbXVtICYmIHR5cGVvZiBub2RlLmV4Y2x1c2l2ZU1pbmltdW0gIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtYXhMZW5ndGgobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1heExlbmd0aCAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1heExlbmd0aCA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1heExlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5MZW5ndGgobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluTGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1pbkxlbmd0aCAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1pbkxlbmd0aCA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1pbkxlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBwYXR0ZXJuKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnBhdHRlcm4pIHtcbiAgICAgICAgICAvLyBUT0RPOiBhZGQgcmVnZXhwIHZhbGlkYXRpb24uXG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLnBhdHRlcm4gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtYXhJdGVtcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhJdGVtcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5tYXhJdGVtcyAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1heEl0ZW1zIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWF4SXRlbXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluSXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluSXRlbXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWluSXRlbXMgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5taW5JdGVtcyA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1pbkl0ZW1zIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLiBZb3UgY2FuYHQgaGF2ZSBuZWdhdGl2ZSBhbW91bnQgb2Ygc29tZXRoaW5nLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHVuaXF1ZUl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnVuaXF1ZUl0ZW1zKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLnVuaXF1ZUl0ZW1zICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtYXhQcm9wZXJ0aWVzKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1heFByb3BlcnRpZXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWF4UHJvcGVydGllcyAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1heFByb3BlcnRpZXMgPCAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBtYXhQcm9wZXJ0aWVzIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLiBZb3UgY2FuYHQgaGF2ZSBuZWdhdGl2ZSBhbW91bnQgb2Ygc29tZXRoaW5nLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pblByb3BlcnRpZXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluUHJvcGVydGllcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5taW5Qcm9wZXJ0aWVzICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWluUHJvcGVydGllcyA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1pblByb3BlcnRpZXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgcmVxdWlyZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucmVxdWlyZWQpIHtcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZS5yZXF1aXJlZCkpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYXJyYXknKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUucmVxdWlyZWQuZmlsdGVyKChpdGVtKSA9PiB0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycpLmxlbmd0aCAhPT0gMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignQWxsIHZhbHVlcyBvZiBcInJlcXVpcmVkXCIgZmllbGQgbXVzdCBiZSBzdHJpbmdzJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZW51bShub2RlLCBjdHgpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzID0gW107XG5cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5lbnVtKSB7XG4gICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG5vZGUuZW51bSkpIHJldHVybiBbY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2FycmF5JyksICd2YWx1ZScpXTtcbiAgICAgICAgICBpZiAobm9kZS50eXBlICYmIHR5cGVvZiBub2RlLnR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb25zdCB0eXBlTWltc2F0Y2ggPSBub2RlLmVudW0uZmlsdGVyKFxuICAgICAgICAgICAgICAoaXRlbSkgPT4gIW1hdGNoZXNKc29uU2NoZW1hVHlwZShpdGVtLCBub2RlLnR5cGUpLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdHlwZU1pbXNhdGNoLmZvckVhY2goKHZhbCkgPT4ge1xuICAgICAgICAgICAgICBjdHgucGF0aC5wdXNoKG5vZGUuZW51bS5pbmRleE9mKHZhbCkpO1xuICAgICAgICAgICAgICBlcnJvcnMucHVzaChjdHguY3JlYXRlRXJyb3IoJ0FsbCB2YWx1ZXMgb2YgXCJlbnVtXCIgZmllbGQgbXVzdCBiZSBvZiB0aGUgc2FtZSB0eXBlIGFzIHRoZSBcInR5cGVcIiBmaWVsZC4nLCAndmFsdWUnKSk7XG4gICAgICAgICAgICAgIGN0eC5wYXRoLnBvcCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgICB9LFxuICAgICAgdHlwZShub2RlLCBjdHgpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgICAgIGlmIChub2RlLnR5cGUgJiYgbm9kZS50eXBlICYmIHR5cGVvZiBub2RlLnR5cGUgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgaWYgKG5vZGUudHlwZSAmJiAhWydzdHJpbmcnLCAnb2JqZWN0JywgJ2FycmF5JywgJ2ludGVnZXInLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXS5pbmNsdWRlcyhub2RlLnR5cGUpKSB7XG4gICAgICAgICAgY29uc3QgcG9zc2libGVBbHRlcm5hdGUgPSBnZXRDbG9zZXN0U3RyaW5nKG5vZGUudHlwZSwgWydzdHJpbmcnLCAnb2JqZWN0JywgJ2FycmF5JywgJ2ludGVnZXInLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXSk7XG4gICAgICAgICAgZXJyb3JzLnB1c2goY3R4LmNyZWF0ZUVycm9yKCdPYmplY3QgdHlwZSBjYW4gYmUgb25lIG9mIGZvbGxvd2luZyBvbmx5OiBcInN0cmluZ1wiLCBcIm9iamVjdFwiLCBcImFycmF5XCIsIFwiaW50ZWdlclwiLCBcIm51bWJlclwiLCBcImJvb2xlYW5cIi4nLCAndmFsdWUnLCB7IHBvc3NpYmxlQWx0ZXJuYXRlIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXJyb3JzO1xuICAgICAgfSxcbiAgICAgIGl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLml0ZW1zICYmIEFycmF5LmlzQXJyYXkobm9kZS5pdGVtcykpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIGl0ZW1zIG11c3Qgbm90IGJlIGFuIGFycmF5LiBJdCBtdXN0IGJlIGEgU2NoZW1hIG9iamVjdCcsICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogKCkgPT4gbnVsbCxcbiAgICAgIGRlc2NyaXB0aW9uKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmRlc2NyaXB0aW9uICYmIHR5cGVvZiBub2RlLmRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGZvcm1hdChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5mb3JtYXQgJiYgdHlwZW9mIG5vZGUuZm9ybWF0ICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG51bGxhYmxlKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm51bGxhYmxlICYmIHR5cGVvZiBub2RlLm51bGxhYmxlICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgcmVhZE9ubHkobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucmVhZE9ubHkgJiYgdHlwZW9mIG5vZGUucmVhZE9ubHkgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICB3cml0ZU9ubHkobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUud3JpdGVPbmx5ICYmIHR5cGVvZiBub2RlLndyaXRlT25seSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGRlcHJlY2F0ZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVwcmVjYXRlZCAmJiB0eXBlb2Ygbm9kZS5kZXByZWNhdGVkICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBPcGVuQVBJU2NoZW1hKCkge1xuICAgIHJldHVybiB7XG4gICAgICBvbkVudGVyOiAobm9kZSwgZGVmaW5pdGlvbiwgY3R4KSA9PiBjdHgudmFsaWRhdGVGaWVsZHMoXG4gICAgICAgIHRoaXMuY29uZmlnLCB0aGlzLnJ1bGUsIHRoaXMudmFsaWRhdG9ycyxcbiAgICAgICksXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFZhbGlkYXRlT3BlbkFQSVNjaGVtYTtcbiJdfQ==