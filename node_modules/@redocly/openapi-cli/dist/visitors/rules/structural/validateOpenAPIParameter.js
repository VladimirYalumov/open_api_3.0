"use strict";

class ValidateOpenAPIParameter {
  static get rule() {
    return 'oas3-schema/parameter';
  }

  get validators() {
    return {
      name(node, ctx) {
        if (!node) return null;
        if (!node.name) return ctx.createError(ctx.messageHelpers.missingRequiredField('name'), 'key');
        if (typeof node.name !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      in(node, ctx) {
        if (!node) return null;
        if (!node.in) return ctx.createError(ctx.messageHelpers.missingRequiredField('in'), 'key');
        if (typeof node.in !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        if (!['query', 'header', 'path', 'cookie'].includes(node.in)) return ctx.createError("The 'in' field value can be only one of: 'query', 'header', 'path', 'cookie'", 'value');
        return null;
      },

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      required(node, ctx) {
        if (node && node.required && typeof node.required !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');

        if (node && node.in && node.in === 'path' && node.required !== true) {
          return ctx.createError('If the parameter location is "path", this property is REQUIRED and its value MUST be true.', 'value');
        }

        return null;
      },

      deprecated(node, ctx) {
        if (node && node.deprecated && typeof node.deprecated !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      allowEmptyValue(node, ctx) {
        if (node && node.allowEmptyValue && typeof node.allowEmptyValue !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      style(node, ctx) {
        if (node && node.style && typeof node.style !== 'string') {
          return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      explode(node, ctx) {
        if (node && node.explode && typeof node.explode !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      allowReserved(node, ctx) {
        if (node && node.allowReserved && typeof node.allowReserved !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      example(node, ctx) {
        if (node.example && node.examples) return ctx.createError(ctx.messageHelpers.mutuallyExclusiveFieldsMessageHelper(['example', 'examples']), 'key');
        return null;
      },

      examples(node, ctx) {
        if (node.example && node.examples) return ctx.createError(ctx.messageHelpers.mutuallyExclusiveFieldsMessageHelper(['examples', 'example']), 'key');
        return null;
      },

      schema(node, ctx) {
        if (node.schema && node.content) {
          return ctx.createError(ctx.messageHelpers.mutuallyExclusiveFieldsMessageHelper(['schema', 'content']), 'key');
        }

        return null;
      },

      content(node, ctx) {
        if (node.schema && node.content) {
          return ctx.createError(ctx.messageHelpers.mutuallyExclusiveFieldsMessageHelper(['content', 'schema']), 'key');
        }

        return null;
      }

    };
  }

  OpenAPIParameter() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOpenAPIParameter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9zdHJ1Y3R1cmFsL3ZhbGlkYXRlT3BlbkFQSVBhcmFtZXRlci5qcyJdLCJuYW1lcyI6WyJWYWxpZGF0ZU9wZW5BUElQYXJhbWV0ZXIiLCJydWxlIiwidmFsaWRhdG9ycyIsIm5hbWUiLCJub2RlIiwiY3R4IiwiY3JlYXRlRXJyb3IiLCJtZXNzYWdlSGVscGVycyIsIm1pc3NpbmdSZXF1aXJlZEZpZWxkIiwiZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyIiwiaW4iLCJpbmNsdWRlcyIsImRlc2NyaXB0aW9uIiwicmVxdWlyZWQiLCJkZXByZWNhdGVkIiwiYWxsb3dFbXB0eVZhbHVlIiwic3R5bGUiLCJleHBsb2RlIiwiYWxsb3dSZXNlcnZlZCIsImV4YW1wbGUiLCJleGFtcGxlcyIsIm11dHVhbGx5RXhjbHVzaXZlRmllbGRzTWVzc2FnZUhlbHBlciIsInNjaGVtYSIsImNvbnRlbnQiLCJPcGVuQVBJUGFyYW1ldGVyIiwib25FbnRlciIsImRlZmluaXRpb24iLCJ2YWxpZGF0ZUZpZWxkcyIsImNvbmZpZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsd0JBQU4sQ0FBK0I7QUFDN0IsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLHVCQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsVUFBSixHQUFpQjtBQUNmLFdBQU87QUFDTEMsTUFBQUEsSUFBSSxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNkLFlBQUksQ0FBQ0QsSUFBTCxFQUFXLE9BQU8sSUFBUDtBQUNYLFlBQUksQ0FBQ0EsSUFBSSxDQUFDRCxJQUFWLEVBQWdCLE9BQU9FLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyxvQkFBbkIsQ0FBd0MsTUFBeEMsQ0FBaEIsRUFBaUUsS0FBakUsQ0FBUDtBQUNoQixZQUFJLE9BQU9KLElBQUksQ0FBQ0QsSUFBWixLQUFxQixR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QWhHLENBQVA7QUFDRDs7QUFDRCxlQUFPLElBQVA7QUFDRDs7QUFsRUksS0FBUDtBQW9FRDs7QUFFREcsRUFBQUEsZ0JBQWdCLEdBQUc7QUFDakIsV0FBTztBQUNMQyxNQUFBQSxPQUFPLEVBQUUsQ0FBQ3JCLElBQUQsRUFBT3NCLFVBQVAsRUFBbUJyQixHQUFuQixLQUEyQkEsR0FBRyxDQUFDc0IsY0FBSixDQUNsQyxLQUFLQyxNQUQ2QixFQUNyQixLQUFLM0IsSUFEZ0IsRUFDVixLQUFLQyxVQURLO0FBRC9CLEtBQVA7QUFLRDs7QUFsRjRCOztBQXFGL0IyQixNQUFNLENBQUNDLE9BQVAsR0FBaUI5Qix3QkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBWYWxpZGF0ZU9wZW5BUElQYXJhbWV0ZXIge1xuICBzdGF0aWMgZ2V0IHJ1bGUoKSB7XG4gICAgcmV0dXJuICdvYXMzLXNjaGVtYS9wYXJhbWV0ZXInO1xuICB9XG5cbiAgZ2V0IHZhbGlkYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmICghbm9kZSkgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5uYW1lKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgnbmFtZScpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS5uYW1lICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGluKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUuaW4pIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCdpbicpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS5pbiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICBpZiAoIVsncXVlcnknLCAnaGVhZGVyJywgJ3BhdGgnLCAnY29va2llJ10uaW5jbHVkZXMobm9kZS5pbikpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoXCJUaGUgJ2luJyBmaWVsZCB2YWx1ZSBjYW4gYmUgb25seSBvbmUgb2Y6ICdxdWVyeScsICdoZWFkZXInLCAncGF0aCcsICdjb29raWUnXCIsICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5kZXNjcmlwdGlvbiAmJiB0eXBlb2Ygbm9kZS5kZXNjcmlwdGlvbiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICByZXF1aXJlZChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5yZXF1aXJlZCAmJiB0eXBlb2Ygbm9kZS5yZXF1aXJlZCAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ3BhdGgnICYmIG5vZGUucmVxdWlyZWQgIT09IHRydWUpIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdJZiB0aGUgcGFyYW1ldGVyIGxvY2F0aW9uIGlzIFwicGF0aFwiLCB0aGlzIHByb3BlcnR5IGlzIFJFUVVJUkVEIGFuZCBpdHMgdmFsdWUgTVVTVCBiZSB0cnVlLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGRlcHJlY2F0ZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVwcmVjYXRlZCAmJiB0eXBlb2Ygbm9kZS5kZXByZWNhdGVkICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgYWxsb3dFbXB0eVZhbHVlKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmFsbG93RW1wdHlWYWx1ZSAmJiB0eXBlb2Ygbm9kZS5hbGxvd0VtcHR5VmFsdWUgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBzdHlsZShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5zdHlsZSAmJiB0eXBlb2Ygbm9kZS5zdHlsZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBleHBsb2RlKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmV4cGxvZGUgJiYgdHlwZW9mIG5vZGUuZXhwbG9kZSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGFsbG93UmVzZXJ2ZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuYWxsb3dSZXNlcnZlZCAmJiB0eXBlb2Ygbm9kZS5hbGxvd1Jlc2VydmVkICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhhbXBsZShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuZXhhbXBsZSAmJiBub2RlLmV4YW1wbGVzKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5tdXR1YWxseUV4Y2x1c2l2ZUZpZWxkc01lc3NhZ2VIZWxwZXIoWydleGFtcGxlJywgJ2V4YW1wbGVzJ10pLCAna2V5Jyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGV4YW1wbGVzKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5leGFtcGxlICYmIG5vZGUuZXhhbXBsZXMpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm11dHVhbGx5RXhjbHVzaXZlRmllbGRzTWVzc2FnZUhlbHBlcihbJ2V4YW1wbGVzJywgJ2V4YW1wbGUnXSksICdrZXknKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgc2NoZW1hKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5zY2hlbWEgJiYgbm9kZS5jb250ZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubXV0dWFsbHlFeGNsdXNpdmVGaWVsZHNNZXNzYWdlSGVscGVyKFsnc2NoZW1hJywgJ2NvbnRlbnQnXSksICdrZXknKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBjb250ZW50KG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5zY2hlbWEgJiYgbm9kZS5jb250ZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubXV0dWFsbHlFeGNsdXNpdmVGaWVsZHNNZXNzYWdlSGVscGVyKFsnY29udGVudCcsICdzY2hlbWEnXSksICdrZXknKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIE9wZW5BUElQYXJhbWV0ZXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9uRW50ZXI6IChub2RlLCBkZWZpbml0aW9uLCBjdHgpID0+IGN0eC52YWxpZGF0ZUZpZWxkcyhcbiAgICAgICAgdGhpcy5jb25maWcsIHRoaXMucnVsZSwgdGhpcy52YWxpZGF0b3JzLFxuICAgICAgKSxcbiAgICB9O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVmFsaWRhdGVPcGVuQVBJUGFyYW1ldGVyO1xuIl19