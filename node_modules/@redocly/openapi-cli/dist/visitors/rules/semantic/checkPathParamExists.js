"use strict";

class CheckPathParamExists {
  static get rule() {
    return 'path-param-exists';
  }

  OpenAPIParameter() {
    return {
      onEnter: (node, _definition, ctx) => {
        // if not path parameter
        if (node.in && node.in !== 'path') {
          return [];
        }

        const fullPath = [...ctx.pathStack.reduce((acc, val) => [...acc, ...val.path], []), ...ctx.path]; // not referenced from path

        if (!fullPath.length || fullPath[0] !== 'paths') {
          return [];
        }

        const errors = [];
        const isNameInPath = fullPath.some(pathNode => typeof pathNode === 'string' && pathNode.indexOf(`{${node.name}}`) !== -1);

        if (!isNameInPath) {
          ctx.path.push('name');
          errors.push(ctx.createError('The "name" field value is not in the current path.', 'value'));
          ctx.path.pop();
        }

        return errors;
      }
    };
  }

}

module.exports = CheckPathParamExists;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9zZW1hbnRpYy9jaGVja1BhdGhQYXJhbUV4aXN0cy5qcyJdLCJuYW1lcyI6WyJDaGVja1BhdGhQYXJhbUV4aXN0cyIsInJ1bGUiLCJPcGVuQVBJUGFyYW1ldGVyIiwib25FbnRlciIsIm5vZGUiLCJfZGVmaW5pdGlvbiIsImN0eCIsImluIiwiZnVsbFBhdGgiLCJwYXRoU3RhY2siLCJyZWR1Y2UiLCJhY2MiLCJ2YWwiLCJwYXRoIiwibGVuZ3RoIiwiZXJyb3JzIiwiaXNOYW1lSW5QYXRoIiwic29tZSIsInBhdGhOb2RlIiwiaW5kZXhPZiIsIm5hbWUiLCJwdXNoIiwiY3JlYXRlRXJyb3IiLCJwb3AiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLG9CQUFOLENBQTJCO0FBQ3pCLGFBQVdDLElBQVgsR0FBa0I7QUFDaEIsV0FBTyxtQkFBUDtBQUNEOztBQUVEQyxFQUFBQSxnQkFBZ0IsR0FBRztBQUNqQixXQUFPO0FBQ0xDLE1BQUFBLE9BQU8sRUFBRSxDQUFDQyxJQUFELEVBQU9DLFdBQVAsRUFBb0JDLEdBQXBCLEtBQTRCO0FBQ25DO0FBQ0EsWUFBSUYsSUFBSSxDQUFDRyxFQUFMLElBQVdILElBQUksQ0FBQ0csRUFBTCxLQUFZLE1BQTNCLEVBQW1DO0FBQ2pDLGlCQUFPLEVBQVA7QUFDRDs7QUFFQSxjQUFNQyxRQUFRLEdBQUcsQ0FDZixHQUFHRixHQUFHLENBQUNHLFNBQUosQ0FBY0MsTUFBZCxDQUFxQixDQUFDQyxHQUFELEVBQU1DLEdBQU4sS0FBYyxDQUFDLEdBQUdELEdBQUosRUFBUyxHQUFJQyxHQUFHLENBQUNDLElBQWpCLENBQW5DLEVBQTRELEVBQTVELENBRFksRUFFZixHQUFHUCxHQUFHLENBQUNPLElBRlEsQ0FBakIsQ0FOa0MsQ0FXbkM7O0FBQ0EsWUFBSSxDQUFDTCxRQUFRLENBQUNNLE1BQVYsSUFBb0JOLFFBQVEsQ0FBQyxDQUFELENBQVIsS0FBZ0IsT0FBeEMsRUFBaUQ7QUFDL0MsaUJBQU8sRUFBUDtBQUNEOztBQUVELGNBQU1PLE1BQU0sR0FBRyxFQUFmO0FBRUEsY0FBTUMsWUFBWSxHQUFHUixRQUFRLENBQzFCUyxJQURrQixDQUNaQyxRQUFELElBQWMsT0FBT0EsUUFBUCxLQUFvQixRQUFwQixJQUFnQ0EsUUFBUSxDQUFDQyxPQUFULENBQWtCLElBQUdmLElBQUksQ0FBQ2dCLElBQUssR0FBL0IsTUFBdUMsQ0FBQyxDQUR6RSxDQUFyQjs7QUFHQSxZQUFJLENBQUNKLFlBQUwsRUFBbUI7QUFDakJWLFVBQUFBLEdBQUcsQ0FBQ08sSUFBSixDQUFTUSxJQUFULENBQWMsTUFBZDtBQUNBTixVQUFBQSxNQUFNLENBQUNNLElBQVAsQ0FBWWYsR0FBRyxDQUFDZ0IsV0FBSixDQUFnQixvREFBaEIsRUFBc0UsT0FBdEUsQ0FBWjtBQUNBaEIsVUFBQUEsR0FBRyxDQUFDTyxJQUFKLENBQVNVLEdBQVQ7QUFDRDs7QUFDRCxlQUFPUixNQUFQO0FBQ0Q7QUE1QkksS0FBUDtBQThCRDs7QUFwQ3dCOztBQXNDM0JTLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnpCLG9CQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENoZWNrUGF0aFBhcmFtRXhpc3RzIHtcbiAgc3RhdGljIGdldCBydWxlKCkge1xuICAgIHJldHVybiAncGF0aC1wYXJhbS1leGlzdHMnO1xuICB9XG5cbiAgT3BlbkFQSVBhcmFtZXRlcigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgb25FbnRlcjogKG5vZGUsIF9kZWZpbml0aW9uLCBjdHgpID0+IHtcbiAgICAgICAgLy8gaWYgbm90IHBhdGggcGFyYW1ldGVyXG4gICAgICAgIGlmIChub2RlLmluICYmIG5vZGUuaW4gIT09ICdwYXRoJykge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgICBjb25zdCBmdWxsUGF0aCA9IFtcbiAgICAgICAgICAgLi4uY3R4LnBhdGhTdGFjay5yZWR1Y2UoKGFjYywgdmFsKSA9PiBbLi4uYWNjLCAuLi4odmFsLnBhdGgpXSwgW10pLFxuICAgICAgICAgICAuLi5jdHgucGF0aFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIG5vdCByZWZlcmVuY2VkIGZyb20gcGF0aFxuICAgICAgICBpZiAoIWZ1bGxQYXRoLmxlbmd0aCB8fCBmdWxsUGF0aFswXSAhPT0gJ3BhdGhzJykge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuXG4gICAgICAgIGNvbnN0IGlzTmFtZUluUGF0aCA9IGZ1bGxQYXRoXG4gICAgICAgICAgLnNvbWUoKHBhdGhOb2RlKSA9PiB0eXBlb2YgcGF0aE5vZGUgPT09ICdzdHJpbmcnICYmIHBhdGhOb2RlLmluZGV4T2YoYHske25vZGUubmFtZX19YCkgIT09IC0xKTtcblxuICAgICAgICBpZiAoIWlzTmFtZUluUGF0aCkge1xuICAgICAgICAgIGN0eC5wYXRoLnB1c2goJ25hbWUnKTtcbiAgICAgICAgICBlcnJvcnMucHVzaChjdHguY3JlYXRlRXJyb3IoJ1RoZSBcIm5hbWVcIiBmaWVsZCB2YWx1ZSBpcyBub3QgaW4gdGhlIGN1cnJlbnQgcGF0aC4nLCAndmFsdWUnKSk7XG4gICAgICAgICAgY3R4LnBhdGgucG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVycm9ycztcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxubW9kdWxlLmV4cG9ydHMgPSBDaGVja1BhdGhQYXJhbUV4aXN0cztcbiJdfQ==