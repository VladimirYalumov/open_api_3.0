"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.matchesJsonSchemaType = matchesJsonSchemaType;
exports.lexicalDistance = lexicalDistance;
exports.getClosestString = getClosestString;
exports.isRef = isRef;
exports.debounce = debounce;
exports.getFileSync = exports.getLineNumberFromId = exports.outputYellow = exports.outputBgYellow = exports.outputBgRed = exports.outputGrey = exports.outputLightBlue = exports.outputBgLightBlue = exports.outputUnderline = exports.outputRed = exports.isFullyQualifiedUrl = exports.isUrl = void 0;

var _xmlhttprequest = require("xmlhttprequest");

var _chalk = _interopRequireDefault(require("chalk"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// @ts-check

/** @typedef {'string'|'number'|'integer'|'boolean'|'null'|'object'|'array'} JSONSchemaType */

/* eslint-disable import/prefer-default-export */
const urlPattern = new RegExp('^(https?:\\/\\/)?' // protocol
+ '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' // domain name
+ '((\\d{1,3}\\.){3}\\d{1,3}))' // OR ip (v4) address
+ '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' // port and path
+ '(\\?[;&a-z\\d%_.~+=-]*)?' // query string
+ '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator

/* eslint-disable import/prefer-default-export */

const fullyQualifiedUrlPattern = new RegExp('^(https?:\\/\\/)' // protocol
+ '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' // domain name
+ '((\\d{1,3}\\.){3}\\d{1,3}))' // OR ip (v4) address
+ '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' // port and path
+ '(\\?[;&a-z\\d%_.~+=-]*)?' // query string
+ '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator

const isUrl = string => urlPattern.test(string);

exports.isUrl = isUrl;

const isFullyQualifiedUrl = string => fullyQualifiedUrlPattern.test(string);

exports.isFullyQualifiedUrl = isFullyQualifiedUrl;

const outputRed = str => _chalk.default.red(str);

exports.outputRed = outputRed;

const outputUnderline = str => _chalk.default.underline(str);

exports.outputUnderline = outputUnderline;

const outputBgLightBlue = str => _chalk.default.bgBlueBright(str);

exports.outputBgLightBlue = outputBgLightBlue;

const outputLightBlue = str => _chalk.default.blueBright(str);

exports.outputLightBlue = outputLightBlue;

const outputGrey = str => _chalk.default.grey(str);

exports.outputGrey = outputGrey;

const outputBgRed = str => _chalk.default.bgRed(str);

exports.outputBgRed = outputBgRed;

const outputBgYellow = str => _chalk.default.bgYellow(str);

exports.outputBgYellow = outputBgYellow;

const outputYellow = str => _chalk.default.yellow(str);

exports.outputYellow = outputYellow;

const getLineNumberFromId = (source, charId) => {
  let lineNum = 1;
  let posNum = 0;

  for (let i = 0; i < charId; i += 1) {
    if (source[i] === '\n') {
      lineNum += 1;
      posNum = charId - i;
    }
  }

  return {
    lineNum,
    posNum
  };
};
/**
 * Checks if value matches specified JSON schema type
 *
 * @param {*} value - value to check
 * @param {JSONSchemaType} type - JSON Schema type
 * @returns string
 */


exports.getLineNumberFromId = getLineNumberFromId;

function matchesJsonSchemaType(value, type) {
  switch (type) {
    case 'array':
      return Array.isArray(value);

    case 'object':
      return typeof value === 'object' && value !== null && !Array.isArray(value);

    case 'null':
      return value === null;

    case 'integer':
      return Number.isInteger(value);

    default:
      // eslint-disable-next-line valid-typeof
      return typeof value === type;
  }
}
/**
  *
  * MIT License
  *
  * Copyright (c) 2019 GraphQL Contributors
  *
  * Permission is hereby granted, free of charge, to any person obtaining a copy
  * of this software and associated documentation files (the "Software"), to deal
  * in the Software without restriction, including without limitation the rights
  * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  * copies of the Software, and to permit persons to whom the Software is
  * furnished to do so, subject to the following conditions:
  *
  * The above copyright notice and this permission notice shall be included in all
  * copies or substantial portions of the Software.
  *
  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  * SOFTWARE.
  *
  * Computes the lexical distance between strings A and B.
  *
  * The "distance" between two strings is given by counting the minimum number
  * of edits needed to transform string A into string B. An edit can be an
  * insertion, deletion, or substitution of a single character, or a swap of two
  * adjacent characters.
  *
  * Includes a custom alteration from Damerau-Levenshtein to treat case changes
  * as a single edit which helps identify mis-cased values with an edit distance
  * of 1.
  *
  * This distance can be useful for detecting typos in input or sorting
  *
  * @param {string} aStr
  * @param {string} bStr
  * @return {number} distance in number of edits
  */


function lexicalDistance(aStr, bStr) {
  if (aStr === bStr) {
    return 0;
  }

  const d = [];
  const a = aStr.toLowerCase();
  const b = bStr.toLowerCase();
  const aLength = a.length;
  const bLength = b.length; // Any case change counts as a single edit

  if (a === b) {
    return 1;
  }

  for (let i = 0; i <= aLength; i++) {
    d[i] = [i];
  }

  for (let j = 1; j <= bLength; j++) {
    d[0][j] = j;
  }

  for (let i = 1; i <= aLength; i++) {
    for (let j = 1; j <= bLength; j++) {
      const cost = a[i - 1] === b[j - 1] ? 0 : 1;
      d[i][j] = Math.min(d[i - 1][j] + 1, d[i][j - 1] + 1, d[i - 1][j - 1] + cost);

      if (i > 1 && j > 1 && a[i - 1] === b[j - 2] && a[i - 2] === b[j - 1]) {
        d[i][j] = Math.min(d[i][j], d[i - 2][j - 2] + cost);
      }
    }
  }

  return d[aLength][bLength];
}

function getClosestString(given, others) {
  if (!others || others.length === 0) return null;
  let bestMatch = {
    string: others[0],
    distance: lexicalDistance(given, others[0])
  };

  for (let i = 0; i < others.length; i++) {
    const distance = lexicalDistance(given, others[i]);
    bestMatch = distance < bestMatch.distance ? {
      string: others[i],
      distance
    } : bestMatch;
  }

  if (bestMatch.distance <= 4) return bestMatch.string;
  return null;
}

const getFileSync = link => {
  const xhr = new _xmlhttprequest.XMLHttpRequest();
  xhr.open('GET', link, false);
  xhr.send();

  if (xhr.status !== 200) {
    return null;
  }

  return xhr.responseText;
};

exports.getFileSync = getFileSync;

function isRef(node) {
  return node && Object.prototype.hasOwnProperty.call(node, '$ref');
}

function debounce(func, wait, immediate) {
  let timeout;
  return function executedFunction(...args) {
    const context = this;

    const later = () => {
      timeout = null;
      if (!immediate) func.apply(context, args);
    };

    const callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) func.apply(context, args);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9pbmRleC5qcyJdLCJuYW1lcyI6WyJ1cmxQYXR0ZXJuIiwiUmVnRXhwIiwiZnVsbHlRdWFsaWZpZWRVcmxQYXR0ZXJuIiwiaXNVcmwiLCJzdHJpbmciLCJ0ZXN0IiwiaXNGdWxseVF1YWxpZmllZFVybCIsIm91dHB1dFJlZCIsInN0ciIsImNoYWxrIiwicmVkIiwib3V0cHV0VW5kZXJsaW5lIiwidW5kZXJsaW5lIiwib3V0cHV0QmdMaWdodEJsdWUiLCJiZ0JsdWVCcmlnaHQiLCJvdXRwdXRMaWdodEJsdWUiLCJibHVlQnJpZ2h0Iiwib3V0cHV0R3JleSIsImdyZXkiLCJvdXRwdXRCZ1JlZCIsImJnUmVkIiwib3V0cHV0QmdZZWxsb3ciLCJiZ1llbGxvdyIsIm91dHB1dFllbGxvdyIsInllbGxvdyIsImdldExpbmVOdW1iZXJGcm9tSWQiLCJzb3VyY2UiLCJjaGFySWQiLCJsaW5lTnVtIiwicG9zTnVtIiwiaSIsIm1hdGNoZXNKc29uU2NoZW1hVHlwZSIsInZhbHVlIiwidHlwZSIsIkFycmF5IiwiaXNBcnJheSIsIk51bWJlciIsImlzSW50ZWdlciIsImxleGljYWxEaXN0YW5jZSIsImFTdHIiLCJiU3RyIiwiZCIsImEiLCJ0b0xvd2VyQ2FzZSIsImIiLCJhTGVuZ3RoIiwibGVuZ3RoIiwiYkxlbmd0aCIsImoiLCJjb3N0IiwiTWF0aCIsIm1pbiIsImdldENsb3Nlc3RTdHJpbmciLCJnaXZlbiIsIm90aGVycyIsImJlc3RNYXRjaCIsImRpc3RhbmNlIiwiZ2V0RmlsZVN5bmMiLCJsaW5rIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwic2VuZCIsInN0YXR1cyIsInJlc3BvbnNlVGV4dCIsImlzUmVmIiwibm9kZSIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlYm91bmNlIiwiZnVuYyIsIndhaXQiLCJpbW1lZGlhdGUiLCJ0aW1lb3V0IiwiZXhlY3V0ZWRGdW5jdGlvbiIsImFyZ3MiLCJjb250ZXh0IiwibGF0ZXIiLCJhcHBseSIsImNhbGxOb3ciLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7OztBQUpBOztBQUNBOztBQUtBO0FBQ0EsTUFBTUEsVUFBVSxHQUFHLElBQUlDLE1BQUosQ0FBVyxvQkFBb0I7QUFBcEIsRUFDNUIsa0RBRDRCLENBQ3VCO0FBRHZCLEVBRTVCLDZCQUY0QixDQUVFO0FBRkYsRUFHNUIsaUNBSDRCLENBR007QUFITixFQUk1QiwwQkFKNEIsQ0FJRDtBQUpDLEVBSzVCLG9CQUxpQixFQUtLLEdBTEwsQ0FBbkIsQyxDQUs4Qjs7QUFDOUI7O0FBQ0EsTUFBTUMsd0JBQXdCLEdBQUcsSUFBSUQsTUFBSixDQUFXLG1CQUFtQjtBQUFuQixFQUMxQyxrREFEMEMsQ0FDUztBQURULEVBRTFDLDZCQUYwQyxDQUVaO0FBRlksRUFHMUMsaUNBSDBDLENBR1I7QUFIUSxFQUkxQywwQkFKMEMsQ0FJZjtBQUplLEVBSzFDLG9CQUwrQixFQUtULEdBTFMsQ0FBakMsQyxDQUs4Qjs7QUFFdkIsTUFBTUUsS0FBSyxHQUFJQyxNQUFELElBQVlKLFVBQVUsQ0FBQ0ssSUFBWCxDQUFnQkQsTUFBaEIsQ0FBMUI7Ozs7QUFDQSxNQUFNRSxtQkFBbUIsR0FBSUYsTUFBRCxJQUFZRix3QkFBd0IsQ0FBQ0csSUFBekIsQ0FBOEJELE1BQTlCLENBQXhDOzs7O0FBRUEsTUFBTUcsU0FBUyxHQUFJQyxHQUFELElBQVNDLGVBQU1DLEdBQU4sQ0FBVUYsR0FBVixDQUEzQjs7OztBQUNBLE1BQU1HLGVBQWUsR0FBSUgsR0FBRCxJQUFTQyxlQUFNRyxTQUFOLENBQWdCSixHQUFoQixDQUFqQzs7OztBQUNBLE1BQU1LLGlCQUFpQixHQUFJTCxHQUFELElBQVNDLGVBQU1LLFlBQU4sQ0FBbUJOLEdBQW5CLENBQW5DOzs7O0FBRUEsTUFBTU8sZUFBZSxHQUFJUCxHQUFELElBQVNDLGVBQU1PLFVBQU4sQ0FBaUJSLEdBQWpCLENB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LEdBQUcsQ0FBQ0ksTUFBSixLQUFlLEdBQW5CLEVBQXdCO0FBQ3RCLFdBQU8sSUFBUDtBQUNEOztBQUNELFNBQU9KLEdBQUcsQ0FBQ0ssWUFBWDtBQUNELENBVE07Ozs7QUFXQSxTQUFTQyxLQUFULENBQWVDLElBQWYsRUFBcUI7QUFDMUIsU0FBT0EsSUFBSSxJQUFJQyxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ0osSUFBckMsRUFBMkMsTUFBM0MsQ0FBZjtBQUNEOztBQUVNLFNBQVNLLFFBQVQsQ0FBa0JDLElBQWxCLEVBQXdCQyxJQUF4QixFQUE4QkMsU0FBOUIsRUFBeUM7QUFDOUMsTUFBSUMsT0FBSjtBQUVBLFNBQU8sU0FBU0MsZ0JBQVQsQ0FBMEIsR0FBR0MsSUFBN0IsRUFBbUM7QUFDeEMsVUFBTUMsT0FBTyxHQUFHLElBQWhCOztBQUVBLFVBQU1DLEtBQUssR0FBRyxNQUFNO0FBQ2xCSixNQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUNBLFVBQUksQ0FBQ0QsU0FBTCxFQUFnQkYsSUFBSSxDQUFDUSxLQUFMLENBQVdGLE9BQVgsRUFBb0JELElBQXBCO0FBQ2pCLEtBSEQ7O0FBS0EsVUFBTUksT0FBTyxHQUFHUCxTQUFTLElBQUksQ0FBQ0MsT0FBOUI7QUFFQU8sSUFBQUEsWUFBWSxDQUFDUCxPQUFELENBQVo7QUFFQUEsSUFBQUEsT0FBTyxHQUFHUSxVQUFVLENBQUNKLEtBQUQsRUFBUU4sSUFBUixDQUFwQjtBQUVBLFFBQUlRLE9BQUosRUFBYVQsSUFBSSxDQUFDUSxLQUFMLENBQVdGLE9BQVgsRUFBb0JELElBQXBCO0FBQ2QsR0FmRDtBQWdCRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1jaGVja1xuLyoqIEB0eXBlZGVmIHsnc3RyaW5nJ3wnbnVtYmVyJ3wnaW50ZWdlcid8J2Jvb2xlYW4nfCdudWxsJ3wnb2JqZWN0J3wnYXJyYXknfSBKU09OU2NoZW1hVHlwZSAqL1xuXG5pbXBvcnQgeyBYTUxIdHRwUmVxdWVzdCB9IGZyb20gJ3htbGh0dHByZXF1ZXN0JztcbmltcG9ydCBjaGFsayBmcm9tICdjaGFsayc7XG5cbi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9wcmVmZXItZGVmYXVsdC1leHBvcnQgKi9cbmNvbnN0IHVybFBhdHRlcm4gPSBuZXcgUmVnRXhwKCdeKGh0dHBzPzpcXFxcL1xcXFwvKT8nIC8vIHByb3RvY29sXG4rICcoKChbYS16XFxcXGRdKFthLXpcXFxcZC1dKlthLXpcXFxcZF0pKilcXFxcLikrW2Etel17Mix9fCcgLy8gZG9tYWluIG5hbWVcbisgJygoXFxcXGR7MSwzfVxcXFwuKXszfVxcXFxkezEsM30pKScgLy8gT1IgaXAgKHY0KSBhZGRyZXNzXG4rICcoXFxcXDpcXFxcZCspPyhcXFxcL1stYS16XFxcXGQlXy5+K10qKSonIC8vIHBvcnQgYW5kIHBhdGhcbisgJyhcXFxcP1s7JmEtelxcXFxkJV8ufis9LV0qKT8nIC8vIHF1ZXJ5IHN0cmluZ1xuKyAnKFxcXFwjWy1hLXpcXFxcZF9dKik/JCcsICdpJyk7IC8vIGZyYWdtZW50IGxvY2F0b3Jcbi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9wcmVmZXItZGVmYXVsdC1leHBvcnQgKi9cbmNvbnN0IGZ1bGx5UXVhbGlmaWVkVXJsUGF0dGVybiA9IG5ldyBSZWdFeHAoJ14oaHR0cHM/OlxcXFwvXFxcXC8pJyAvLyBwcm90b2NvbFxuKyAnKCgoW2EtelxcXFxkXShbYS16XFxcXGQtXSpbYS16XFxcXGRdKSopXFxcXC4pK1thLXpdezIsfXwnIC8vIGRvbWFpbiBuYW1lXG4rICcoKFxcXFxkezEsM31cXFxcLil7M31cXFxcZHsxLDN9KSknIC8vIE9SIGlwICh2NCkgYWRkcmVzc1xuKyAnKFxcXFw6XFxcXGQrKT8oXFxcXC9bLWEtelxcXFxkJV8ufitdKikqJyAvLyBwb3J0IGFuZCBwYXRoXG4rICcoXFxcXD9bOyZhLXpcXFxcZCVfLn4rPS1dKik/JyAvLyBxdWVyeSBzdHJpbmdcbisgJyhcXFxcI1stYS16XFxcXGRfXSopPyQnLCAnaScpOyAvLyBmcmFnbWVudCBsb2NhdG9yXG5cbmV4cG9ydCBjb25zdCBpc1VybCA9IChzdHJpbmcpID0+IHVybFBhdHRlcm4udGVzdChzdHJpbmcpO1xuZXhwb3J0IGNvbnN0IGlzRnVsbHlRdWFsaWZpZWRVcmwgPSAoc3RyaW5nKSA9PiBmdWxseVF1YWxpZmllZFVybFBhdHRlcm4udGVzdChzdHJpbmcpO1xuXG5leHBvcnQgY29uc3Qgb3V0cHV0UmVkID0gKHN0cikgPT4gY2hhbGsucmVkKHN0cik7XG5leHBvcnQgY29uc3Qgb3V0cHV0VW5kZXJsaW5lID0gKHN0cikgPT4gY2hhbGsudW5kZXJsaW5lKHN0cik7XG5leHBvcnQgY29uc3Qgb3V0cHV0QmdMaWdodEJsdWUgPSAoc3RyKSA9PiBjaGFsay5iZ0JsdWVCcmlnaHQoc3RyKTtcblxuZXhwb3J0IGNvbnN0IG91dHB1dExpZ2h0Qmx1ZSA9IChzdHIpID0+IGNoYWxrLmJsdWVCcmlnaHQoc3RyKTtcbmV4cG9ydCBjb25zdCBvdXRwdXRHcmV5ID0gKHN0cikgPT4gY2hhbGsuZ3JleShzdHIpO1xuZXhwb3J0IGNvbnN0IG91dHB1dEJnUmVkID0gKHN0cikgPT4gY2hhbGsuYmdSZWQoc3RyKTtcbmV4cG9ydCBjb25zdCBvdXRwdXRCZ1llbGxvdyA9IChzdHIpID0+IGNoYWxrLmJnWWVsbG93KHN0cik7XG5leHBvcnQgY29uc3Qgb3V0cHV0WWVsbG93ID0gKHN0cikgPT4gY2hhbGsueWVsbG93KHN0cik7XG5leHBvcnQgY29uc3QgZ2V0TGluZU51bWJlckZyb21JZCA9IChzb3VyY2UsIGNoYXJJZCkgPT4ge1xuICBsZXQgbGluZU51bSA9IDE7XG4gIGxldCBwb3NOdW0gPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYXJJZDsgaSArPSAxKSB7XG4gICAgaWYgKHNvdXJjZVtpXSA9PT0gJ1xcbicpIHtcbiAgICAgIGxpbmVOdW0gKz0gMTtcbiAgICAgIHBvc051bSA9IGNoYXJJZCAtIGk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgbGluZU51bSxcbiAgICBwb3NOdW0sXG4gIH07XG59O1xuXG4vKipcbiAqIENoZWNrcyBpZiB2YWx1ZSBtYXRjaGVzIHNwZWNpZmllZCBKU09OIHNjaGVtYSB0eXBlXG4gKlxuICogQHBhcmFtIHsqfSB2YWx1ZSAtIHZhbHVlIHRvIGNoZWNrXG4gKiBAcGFyYW0ge0pTT05TY2hlbWFUeXBlfSB0eXBlIC0gSlNPTiBTY2hlbWEgdHlwZVxuICogQHJldHVybnMgc3RyaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaGVzSnNvblNjaGVtYVR5cGUodmFsdWUsIHR5cGUpIHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSAnYXJyYXknOlxuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpO1xuICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSk7XG4gICAgY2FzZSAnbnVsbCc6XG4gICAgICByZXR1cm4gdmFsdWUgPT09IG51bGw7XG4gICAgY2FzZSAnaW50ZWdlcic6XG4gICAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSk7XG4gICAgZGVmYXVsdDpcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB2YWxpZC10eXBlb2ZcbiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09IHR5cGU7XG4gIH1cbn1cblxuLyoqXG4gICpcbiAgKiBNSVQgTGljZW5zZVxuICAqXG4gICogQ29weXJpZ2h0IChjKSAyMDE5IEdyYXBoUUwgQ29udHJpYnV0b3JzXG4gICpcbiAgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuICAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4gICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAgKlxuICAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuICAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gICpcbiAgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuICAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcbiAgKiBTT0ZUV0FSRS5cbiAgKlxuICAqIENvbXB1dGVzIHRoZSBsZXhpY2FsIGRpc3RhbmNlIGJldHdlZW4gc3RyaW5ncyBBIGFuZCBCLlxuICAqXG4gICogVGhlIFwiZGlzdGFuY2VcIiBiZXR3ZWVuIHR3byBzdHJpbmdzIGlzIGdpdmVuIGJ5IGNvdW50aW5nIHRoZSBtaW5pbXVtIG51bWJlclxuICAqIG9mIGVkaXRzIG5lZWRlZCB0byB0cmFuc2Zvcm0gc3RyaW5nIEEgaW50byBzdHJpbmcgQi4gQW4gZWRpdCBjYW4gYmUgYW5cbiAgKiBpbnNlcnRpb24sIGRlbGV0aW9uLCBvciBzdWJzdGl0dXRpb24gb2YgYSBzaW5nbGUgY2hhcmFjdGVyLCBvciBhIHN3YXAgb2YgdHdvXG4gICogYWRqYWNlbnQgY2hhcmFjdGVycy5cbiAgKlxuICAqIEluY2x1ZGVzIGEgY3VzdG9tIGFsdGVyYXRpb24gZnJvbSBEYW1lcmF1LUxldmVuc2h0ZWluIHRvIHRyZWF0IGNhc2UgY2hhbmdlc1xuICAqIGFzIGEgc2luZ2xlIGVkaXQgd2hpY2ggaGVscHMgaWRlbnRpZnkgbWlzLWNhc2VkIHZhbHVlcyB3aXRoIGFuIGVkaXQgZGlzdGFuY2VcbiAgKiBvZiAxLlxuICAqXG4gICogVGhpcyBkaXN0YW5jZSBjYW4gYmUgdXNlZnVsIGZvciBkZXRlY3RpbmcgdHlwb3MgaW4gaW5wdXQgb3Igc29ydGluZ1xuICAqXG4gICogQHBhcmFtIHtzdHJpbmd9IGFTdHJcbiAgKiBAcGFyYW0ge3N0cmluZ30gYlN0clxuICAqIEByZXR1cm4ge251bWJlcn0gZGlzdGFuY2UgaW4gbnVtYmVyIG9mIGVkaXRzXG4gICovXG5leHBvcnQgZnVuY3Rpb24gbGV4aWNhbERpc3RhbmNlKGFTdHIsIGJTdHIpIHtcbiAgaWYgKGFTdHIgPT09IGJTdHIpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGNvbnN0IGQgPSBbXTtcbiAgY29uc3QgYSA9IGFTdHIudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgYiA9IGJTdHIudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgYUxlbmd0aCA9IGEubGVuZ3RoO1xuICBjb25zdCBiTGVuZ3RoID0gYi5sZW5ndGg7XG5cbiAgLy8gQW55IGNhc2UgY2hhbmdlIGNvdW50cyBhcyBhIHNpbmdsZSBlZGl0XG4gIGlmIChhID09PSBiKSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cblxuICBmb3IgKGxldCBpID0gMDsgaSA8PSBhTGVuZ3RoOyBpKyspIHtcbiAgICBkW2ldID0gW2ldO1xuICB9XG5cbiAgZm9yIChsZXQgaiA9IDE7IGogPD0gYkxlbmd0aDsgaisrKSB7XG4gICAgZFswXVtqXSA9IGo7XG4gIH1cblxuICBmb3IgKGxldCBpID0gMTsgaSA8PSBhTGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMTsgaiA8PSBiTGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IGNvc3QgPSBhW2kgLSAxXSA9PT0gYltqIC0gMV0gPyAwIDogMTtcblxuICAgICAgZFtpXVtqXSA9IE1hdGgubWluKFxuICAgICAgICBkW2kgLSAxXVtqXSArIDEsXG4gICAgICAgIGRbaV1baiAtIDFdICsgMSxcbiAgICAgICAgZFtpIC0gMV1baiAtIDFdICsgY29zdCxcbiAgICAgICk7XG5cbiAgICAgIGlmIChpID4gMSAmJiBqID4gMSAmJiBhW2kgLSAxXSA9PT0gYltqIC0gMl0gJiYgYVtpIC0gMl0gPT09IGJbaiAtIDFdKSB7XG4gICAgICAgIGRbaV1bal0gPSBNYXRoLm1pbihkW2ldW2pdLCBkW2kgLSAyXVtqIC0gMl0gKyBjb3N0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZFthTGVuZ3RoXVtiTGVuZ3RoXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENsb3Nlc3RTdHJpbmcoZ2l2ZW4sIG90aGVycykge1xuICBpZiAoIW90aGVycyB8fCBvdGhlcnMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDtcbiAgbGV0IGJlc3RNYXRjaCA9IHtcbiAgICBzdHJpbmc6IG90aGVyc1swXSxcbiAgICBkaXN0YW5jZTogbGV4aWNhbERpc3RhbmNlKGdpdmVuLCBvdGhlcnNbMF0pLFxuICB9O1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG90aGVycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGRpc3RhbmNlID0gbGV4aWNhbERpc3RhbmNlKGdpdmVuLCBvdGhlcnNbaV0pO1xuICAgIGJlc3RNYXRjaCA9IGRpc3RhbmNlIDwgYmVzdE1hdGNoLmRpc3RhbmNlID8ge1xuICAgICAgc3RyaW5nOiBvdGhlcnNbaV0sXG4gICAgICBkaXN0YW5jZSxcbiAgICB9IDogYmVzdE1hdGNoO1xuICB9XG5cbiAgaWYgKGJlc3RNYXRjaC5kaXN0YW5jZSA8PSA0KSByZXR1cm4gYmVzdE1hdGNoLnN0cmluZztcbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBjb25zdCBnZXRGaWxlU3luYyA9IChsaW5rKSA9PiB7XG4gIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICB4aHIub3BlbignR0VUJywgbGluaywgZmFsc2UpO1xuICB4aHIuc2VuZCgpO1xuXG4gIGlmICh4aHIuc3RhdHVzICE9PSAyMDApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4geGhyLnJlc3BvbnNlVGV4dDtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1JlZihub2RlKSB7XG4gIHJldHVybiBub2RlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChub2RlLCAnJHJlZicpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7XG4gIGxldCB0aW1lb3V0O1xuXG4gIHJldHVybiBmdW5jdGlvbiBleGVjdXRlZEZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcztcblxuICAgIGNvbnN0IGxhdGVyID0gKCkgPT4ge1xuICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICBpZiAoIWltbWVkaWF0ZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDtcblxuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcblxuICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcblxuICAgIGlmIChjYWxsTm93KSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICB9O1xufVxuIl19