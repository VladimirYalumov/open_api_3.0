"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getConfig = getConfig;
exports.getLintConfig = getLintConfig;
exports.getFallbackEntryPointsOrExit = getFallbackEntryPointsOrExit;

var _fs = _interopRequireDefault(require("fs"));

var _mergeDeep = _interopRequireDefault(require("merge-deep"));

var _jsYaml = _interopRequireDefault(require("js-yaml"));

var path = _interopRequireWildcard(require("path"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let warningShown = false;

function getConfig(options) {
  let config = {};
  let {
    configPath
  } = options;

  if (!configPath) {
    configPath = `${process.cwd()}/.openapi-cli.yaml`;

    if (_fs.default.existsSync('.redocly.yaml')) {
      configPath = path.resolve('.redocly.yaml');
    } else if (_fs.default.existsSync('.redocly.yml')) {
      configPath = path.resolve('.redocly.yml');
    } else if (_fs.default.existsSync('.openapi-cli.yaml')) {
      if (!warningShown) process.stderr.write('warning: .openapi-cli.yaml is deprecated, rename to .redocly.yaml\n');
      configPath = path.resolve('.openapi-cli.yaml');
    } else if (_fs.default.existsSync('.openapi-cli.yml')) {
      if (!warningShown) process.stderr.write('warning: .openapi-cli.yml is deprecated, rename to .redocly.yml\n');
      configPath = path.resolve('.openapi-cli.yml');
    }
  }

  const defaultConfigRaw = _fs.default.readFileSync(`${__dirname}/.redocly.yaml`, 'utf-8');

  const defaultConfig = _jsYaml.default.safeLoad(defaultConfigRaw);

  if (_fs.default.existsSync(configPath)) {
    const configRaw = _fs.default.readFileSync(configPath, 'utf-8');

    config = _jsYaml.default.safeLoad(configRaw);

    if (config.rules || config.transformers || config.typeExtension || config.customRules) {
      if (!warningShown) {
        process.stderr.write('warning: top level "rules", "transformers", "typeExtension" and "customRules" ' + 'are deprecated. Move them under the "lint" field.\n');
      }

      warningShown = true;
      config = {
        lint: config
      };
    }
  }

  const resolvedConfig = (0, _mergeDeep.default)(defaultConfig, config, options);
  resolvedConfig.configPath = configPath;
  const lintConfig = resolvedConfig.lint;

  if (!lintConfig.typeExtension) {
    lintConfig.typeExtension = `${__dirname}/typeExtensionDefault.js`;
  } else {
    lintConfig.typeExtension = `${process.cwd()}/${lintConfig.typeExtension}`;
  }

  const definitionResolver = require(lintConfig.typeExtension);

  lintConfig.definitionResolver = definitionResolver;
  lintConfig.customRules = lintConfig.customRules ? `${process.cwd()}/${lintConfig.customRules}` : `${__dirname}/customRulesDefault.js`;

  const rulesExtensions = require(lintConfig.customRules);

  lintConfig.rulesExtensions = rulesExtensions;
  lintConfig.transformers = lintConfig.transformers ? `${process.cwd()}/${lintConfig.transformers}` : `${__dirname}/customRulesDefault.js`;

  const transformingVisitors = require(lintConfig.transformers);

  lintConfig.transformingVisitors = transformingVisitors;
  return resolvedConfig;
}

function getLintConfig(options) {
  return getConfig(options).lint;
}

function getFallbackEntryPointsOrExit(argsEntrypoints, config = getConfig({})) {
  let res = argsEntrypoints;

  if ((!argsEntrypoints || !argsEntrypoints.length) && config.apiDefinitions && Object.keys(config.apiDefinitions).length > 0) {
    res = Object.values(config.apiDefinitions);
  } else if (argsEntrypoints && argsEntrypoints.length && config.apiDefinitions) {
    res = res.map(aliasOrPath => config.apiDefinitions[aliasOrPath] || aliasOrPath);
  }

  if (!res || !res.length) {
    process.stderr.write('error: missing required argument "entryPoints"\n');
    process.exit(1);
  }

  return res;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWcuanMiXSwibmFtZXMiOlsid2FybmluZ1Nob3duIiwiZ2V0Q29uZmlnIiwib3B0aW9ucyIsImNvbmZpZyIsImNvbmZpZ1BhdGgiLCJwcm9jZXNzIiwiY3dkIiwiZnMiLCJleGlzdHNTeW5jIiwicGF0aCIsInJlc29sdmUiLCJzdGRlcnIiLCJ3cml0ZSIsImRlZmF1bHRDb25maWdSYXciLCJyZWFkRmlsZVN5bmMiLCJfX2Rpcm5hbWUiLCJkZWZhdWx0Q29uZmlnIiwieWFtbCIsInNhZmVMb2FkIiwiY29uZmlnUmF3IiwicnVsZXMiLCJ0cmFuc2Zvcm1lcnMiLCJ0eXBlRXh0ZW5zaW9uIiwiY3VzdG9tUnVsZXMiLCJsaW50IiwicmVzb2x2ZWRDb25maWciLCJsaW50Q29uZmlnIiwiZGVmaW5pdGlvblJlc29sdmVyIiwicmVxdWlyZSIsInJ1bGVzRXh0ZW5zaW9ucyIsInRyYW5zZm9ybWluZ1Zpc2l0b3JzIiwiZ2V0TGludENvbmZpZyIsImdldEZhbGxiYWNrRW50cnlQb2ludHNPckV4aXQiLCJhcmdzRW50cnlwb2ludHMiLCJyZXMiLCJsZW5ndGgiLCJhcGlEZWZpbml0aW9ucyIsIk9iamVjdCIsImtleXMiLCJ2YWx1ZXMiLCJtYXAiLCJhbGlhc09yUGF0aCIsImV4aXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLElBQUlBLFlBQVksR0FBRyxLQUFuQjs7QUFFTyxTQUFTQyxTQUFULENBQW1CQyxPQUFuQixFQUE0QjtBQUNqQyxNQUFJQyxNQUFNLEdBQUcsRUFBYjtBQUNBLE1BQUk7QUFBRUMsSUFBQUE7QUFBRixNQUFpQkYsT0FBckI7O0FBQ0EsTUFBSSxDQUFDRSxVQUFMLEVBQWlCO0FBQ2ZBLElBQUFBLFVBQVUsR0FBSSxHQUFFQyxPQUFPLENBQUNDLEdBQVIsRUFBYyxvQkFBOUI7O0FBRUEsUUFBSUMsWUFBR0MsVUFBSCxDQUFjLGVBQWQsQ0FBSixFQUFvQztBQUNsQ0os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R0FBRCxJQUFRLENBQUNBLEdBQUcsQ0FBQ0MsTUFBakIsRUFBeUI7QUFDdkI5QixJQUFBQSxPQUFPLENBQUNNLE1BQVIsQ0FBZUMsS0FBZixDQUFxQixrREFBckI7QUFDQVAsSUFBQUEsT0FBTyxDQUFDcUMsSUFBUixDQUFhLENBQWI7QUFDRDs7QUFFRCxTQUFPUixHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IG1lcmdlIGZyb20gJ21lcmdlLWRlZXAnO1xuaW1wb3J0IHlhbWwgZnJvbSAnanMteWFtbCc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5sZXQgd2FybmluZ1Nob3duID0gZmFsc2U7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb25maWcob3B0aW9ucykge1xuICBsZXQgY29uZmlnID0ge307XG4gIGxldCB7IGNvbmZpZ1BhdGggfSA9IG9wdGlvbnM7XG4gIGlmICghY29uZmlnUGF0aCkge1xuICAgIGNvbmZpZ1BhdGggPSBgJHtwcm9jZXNzLmN3ZCgpfS8ub3BlbmFwaS1jbGkueWFtbGA7XG5cbiAgICBpZiAoZnMuZXhpc3RzU3luYygnLnJlZG9jbHkueWFtbCcpKSB7XG4gICAgICBjb25maWdQYXRoID0gcGF0aC5yZXNvbHZlKCcucmVkb2NseS55YW1sJyk7XG4gICAgfSBlbHNlIGlmIChmcy5leGlzdHNTeW5jKCcucmVkb2NseS55bWwnKSkge1xuICAgICAgY29uZmlnUGF0aCA9IHBhdGgucmVzb2x2ZSgnLnJlZG9jbHkueW1sJyk7XG4gICAgfSBlbHNlIGlmIChmcy5leGlzdHNTeW5jKCcub3BlbmFwaS1jbGkueWFtbCcpKSB7XG4gICAgICBpZiAoIXdhcm5pbmdTaG93bikgcHJvY2Vzcy5zdGRlcnIud3JpdGUoJ3dhcm5pbmc6IC5vcGVuYXBpLWNsaS55YW1sIGlzIGRlcHJlY2F0ZWQsIHJlbmFtZSB0byAucmVkb2NseS55YW1sXFxuJyk7XG4gICAgICBjb25maWdQYXRoID0gcGF0aC5yZXNvbHZlKCcub3BlbmFwaS1jbGkueWFtbCcpO1xuICAgIH0gZWxzZSBpZiAoZnMuZXhpc3RzU3luYygnLm9wZW5hcGktY2xpLnltbCcpKSB7XG4gICAgICBpZiAoIXdhcm5pbmdTaG93bikgcHJvY2Vzcy5zdGRlcnIud3JpdGUoJ3dhcm5pbmc6IC5vcGVuYXBpLWNsaS55bWwgaXMgZGVwcmVjYXRlZCwgcmVuYW1lIHRvIC5yZWRvY2x5LnltbFxcbicpO1xuICAgICAgY29uZmlnUGF0aCA9IHBhdGgucmVzb2x2ZSgnLm9wZW5hcGktY2xpLnltbCcpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRDb25maWdSYXcgPSBmcy5yZWFkRmlsZVN5bmMoYCR7X19kaXJuYW1lfS8ucmVkb2NseS55YW1sYCwgJ3V0Zi04Jyk7XG4gIGNvbnN0IGRlZmF1bHRDb25maWcgPSB5YW1sLnNhZmVMb2FkKGRlZmF1bHRDb25maWdSYXcpO1xuXG4gIGlmIChmcy5leGlzdHNTeW5jKGNvbmZpZ1BhdGgpKSB7XG4gICAgY29uc3QgY29uZmlnUmF3ID0gZnMucmVhZEZpbGVTeW5jKGNvbmZpZ1BhdGgsICd1dGYtOCcpO1xuICAgIGNvbmZpZyA9IHlhbWwuc2FmZUxvYWQoY29uZmlnUmF3KTtcblxuICAgIGlmIChjb25maWcucnVsZXMgfHwgY29uZmlnLnRyYW5zZm9ybWVycyB8fCBjb25maWcudHlwZUV4dGVuc2lvbiB8fCBjb25maWcuY3VzdG9tUnVsZXMpIHtcbiAgICAgIGlmICghd2FybmluZ1Nob3duKSB7XG4gICAgICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlKFxuICAgICAgICAgICd3YXJuaW5nOiB0b3AgbGV2ZWwgXCJydWxlc1wiLCBcInRyYW5zZm9ybWVyc1wiLCBcInR5cGVFeHRlbnNpb25cIiBhbmQgXCJjdXN0b21SdWxlc1wiICdcbiAgICAgICAgICArICdhcmUgZGVwcmVjYXRlZC4gTW92ZSB0aGVtIHVuZGVyIHRoZSBcImxpbnRcIiBmaWVsZC5cXG4nLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB3YXJuaW5nU2hvd24gPSB0cnVlO1xuXG4gICAgICBjb25maWcgPSB7IGxpbnQ6IGNvbmZpZyB9O1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHJlc29sdmVkQ29uZmlnID0gbWVyZ2UoZGVmYXVsdENvbmZpZywgY29uZmlnLCBvcHRpb25zKTtcbiAgcmVzb2x2ZWRDb25maWcuY29uZmlnUGF0aCA9IGNvbmZpZ1BhdGg7XG5cbiAgY29uc3QgbGludENvbmZpZyA9IHJlc29sdmVkQ29uZmlnLmxpbnQ7XG5cbiAgaWYgKCFsaW50Q29uZmlnLnR5cGVFeHRlbnNpb24pIHtcbiAgICBsaW50Q29uZmlnLnR5cGVFeHRlbnNpb24gPSBgJHtfX2Rpcm5hbWV9L3R5cGVFeHRlbnNpb25EZWZhdWx0LmpzYDtcbiAgfSBlbHNlIHtcbiAgICBsaW50Q29uZmlnLnR5cGVFeHRlbnNpb24gPSBgJHtwcm9jZXNzLmN3ZCgpfS8ke2xpbnRDb25maWcudHlwZUV4dGVuc2lvbn1gO1xuICB9XG5cbiAgY29uc3QgZGVmaW5pdGlvblJlc29sdmVyID0gcmVxdWlyZShsaW50Q29uZmlnLnR5cGVFeHRlbnNpb24pO1xuXG4gIGxpbnRDb25maWcuZGVmaW5pdGlvblJlc29sdmVyID0gZGVmaW5pdGlvblJlc29sdmVyO1xuXG4gIGxpbnRDb25maWcuY3VzdG9tUnVsZXMgPSBsaW50Q29uZmlnLmN1c3RvbVJ1bGVzXG4gICAgPyBgJHtwcm9jZXNzLmN3ZCgpfS8ke2xpbnRDb25maWcuY3VzdG9tUnVsZXN9YCA6IGAke19fZGlybmFtZX0vY3VzdG9tUnVsZXNEZWZhdWx0LmpzYDtcbiAgY29uc3QgcnVsZXNFeHRlbnNpb25zID0gcmVxdWlyZShsaW50Q29uZmlnLmN1c3RvbVJ1bGVzKTtcbiAgbGludENvbmZpZy5ydWxlc0V4dGVuc2lvbnMgPSBydWxlc0V4dGVuc2lvbnM7XG5cbiAgbGludENvbmZpZy50cmFuc2Zvcm1lcnMgPSBsaW50Q29uZmlnLnRyYW5zZm9ybWVyc1xuICAgID8gYCR7cHJvY2Vzcy5jd2QoKX0vJHtsaW50Q29uZmlnLnRyYW5zZm9ybWVyc31gIDogYCR7X19kaXJuYW1lfS9jdXN0b21SdWxlc0RlZmF1bHQuanNgO1xuICBjb25zdCB0cmFuc2Zvcm1pbmdWaXNpdG9ycyA9IHJlcXVpcmUobGludENvbmZpZy50cmFuc2Zvcm1lcnMpO1xuICBsaW50Q29uZmlnLnRyYW5zZm9ybWluZ1Zpc2l0b3JzID0gdHJhbnNmb3JtaW5nVmlzaXRvcnM7XG5cbiAgcmV0dXJuIHJlc29sdmVkQ29uZmlnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGludENvbmZpZyhvcHRpb25zKSB7XG4gIHJldHVybiBnZXRDb25maWcob3B0aW9ucykubGludDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZhbGxiYWNrRW50cnlQb2ludHNPckV4aXQoYXJnc0VudHJ5cG9pbnRzLCBjb25maWcgPSBnZXRDb25maWcoe30pKSB7XG4gIGxldCByZXMgPSBhcmdzRW50cnlwb2ludHM7XG4gIGlmIChcbiAgICAoIWFyZ3NFbnRyeXBvaW50cyB8fCAhYXJnc0VudHJ5cG9pbnRzLmxlbmd0aClcbiAgICAmJiBjb25maWcuYXBpRGVmaW5pdGlvbnNcbiAgICAmJiBPYmplY3Qua2V5cyhjb25maWcuYXBpRGVmaW5pdGlvbnMpLmxlbmd0aCA+IDBcbiAgKSB7XG4gICAgcmVzID0gT2JqZWN0LnZhbHVlcyhjb25maWcuYXBpRGVmaW5pdGlvbnMpO1xuICB9IGVsc2UgaWYgKGFyZ3NFbnRyeXBvaW50cyAmJiBhcmdzRW50cnlwb2ludHMubGVuZ3RoICYmIGNvbmZpZy5hcGlEZWZpbml0aW9ucykge1xuICAgIHJlcyA9IHJlcy5tYXAoYWxpYXNPclBhdGggPT4gY29uZmlnLmFwaURlZmluaXRpb25zW2FsaWFzT3JQYXRoXSB8fCBhbGlhc09yUGF0aCk7XG4gIH1cblxuICBpZiAoIXJlcyB8fCAhcmVzLmxlbmd0aCkge1xuICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlKCdlcnJvcjogbWlzc2luZyByZXF1aXJlZCBhcmd1bWVudCBcImVudHJ5UG9pbnRzXCJcXG4nKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cblxuICByZXR1cm4gcmVzO1xufVxuIl19